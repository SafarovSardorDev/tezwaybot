datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-py"
  previewFeatures = ["prismaSchemaFolder"]
}

enum Role {
  SUPER_ADMIN
  ADMIN
  DRIVER
  PASSENGER
}

enum OrderType {
  PASSENGER  // Yo'lovchi uchun
  DELIVERY   // Pochta uchun
}

enum PackageType {
  DOCUMENT    // Hujjat
  PARCEL      // Posilka
  FRAGILE     // Mo'rt buyum
  VALUABLE    // Qimmatbaho buyum
  OTHER       // Boshqa
}

enum PackageSize {
  SMALL       // Kichik (10kg gacha)
  MEDIUM      // O'rta (10-25kg)
  LARGE       // Katta (25-50kg)
  EXTRA_LARGE // Juda katta (50kg dan ortiq)
}

model User {
  id              Int           @id @default(autoincrement())
  firstName       String
  lastName        String
  telegramId      BigInt        @unique
  phoneNumber     String
  username        String?
  role            Role          @default(PASSENGER)
  passengerOrders Order[]       @relation("PassengerOrders")
  driverOrders    Order[]       @relation("DriverOrders")
  orderStatuses   OrderStatus[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model Order {
  id             Int       @id @default(autoincrement())
  passengerId    Int
  driverId       Int?
  orderType      OrderType @default(PASSENGER)

  fromRegionId   Int
  fromDistrictId Int
  toRegionId     Int
  toDistrictId   Int

  fromRegion     Region    @relation("OrderFromRegion", fields: [fromRegionId], references: [id])
  fromDistrict   District  @relation("OrderFromDistrict", fields: [fromDistrictId], references: [id])
  toRegion       Region    @relation("OrderToRegion", fields: [toRegionId], references: [id])
  toDistrict     District  @relation("OrderToDistrict", fields: [toDistrictId], references: [id])

  // Yo'lovchi uchun fieldlar
  passengers     Int?
  departureTime  DateTime?

  // Pochta uchun fieldlar
  packageType    PackageType?
  packageSize    PackageSize?
  packageWeight  Float?       // kg da
  packageDescription String?   // Qo'shimcha ma'lumot
  
  // Qabul qiluvchi ma'lumotlari
  receiverName   String?
  receiverPhone  String?
  
  // Umumiy fieldlar
  status         OrderStatus?
  passenger      User      @relation("PassengerOrders", fields: [passengerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  driver         User?     @relation("DriverOrders", fields: [driverId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Region {
  id        Int        @id @default(autoincrement())
  name      String     @unique

  ordersFrom Order[]   @relation("OrderFromRegion")
  ordersTo   Order[]   @relation("OrderToRegion")

  districts  District[]
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
}

model District {
  id        Int      @id @default(autoincrement())
  name      String
  regionId  Int
  region    Region   @relation(fields: [regionId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  ordersFrom Order[] @relation("OrderFromDistrict")
  ordersTo   Order[] @relation("OrderToDistrict")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([name, regionId])
}

model OrderStatus {
  id        Int             @id @default(autoincrement())
  status    OrderStatusEnum @default(initiated)
  user      User?           @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId    Int?
  order     Order           @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  orderId   Int             @unique
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
}

enum OrderStatusEnum {
  initiated   // Transaction has been created but not yet processed.
  processing  // Order is currently in progress (jarayonda).
  completed   // Transaction has been successfully completed.
  failed      // Transaction has failed due to an unspecified error.
  canceled    // Transaction has been canceled by the user or system.
}